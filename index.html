<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>캠페인 셀프 견적 & 성과 모니터</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts: Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    body, html { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000; font-family:'Inter',sans-serif; }
    #three-container { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; }
    .ui-container { position:relative; z-index:1; max-width:420px; margin:0 auto; height:100%; display:flex; flex-direction:column; background:rgba(0,0,0,0.4); }
    main { flex:1; display:flex; align-items:center; justify-content:center; }
    section.metrics, section.persuasive { padding:1rem; color:#ccc; }
    section.persuasive { background:rgba(255,255,255,0.05); }
    footer { padding:0 1rem 1rem; }
    .accordion-content { max-height:0; overflow:hidden; transition:max-height .3s, padding .3s; padding:0; }
    .accordion-content.open { max-height:400px; padding:.5rem 0; }
  </style>
</head>
<body>
  <div id="three-container"></div>
  <div class="ui-container">
    <!-- 예상 도달 -->
    <main>
      <div class="text-center">
        <p class="text-gray-400 text-lg">예상 도달</p>
        <p id="total-reach" class="text-6xl font-extrabold text-white">0</p>
      </div>
    </main>

    <!-- 설득형 성과 지표 -->
    <section class="persuasive">
      <h2 class="text-white font-semibold mb-2">실제 고객 평균 성과</h2>
      <ul class="list-disc list-inside space-y-1 text-sm">
        <li>평균 전환율<span class="float-right font-bold text-white">6.2%</span></li>
        <li>클릭당 비용(CPC)<span class="float-right font-bold text-white">₩350</span></li>
        <li>리드 확보<span class="float-right font-bold text-white">1,200건/月</span></li>
        <li>ROI<span class="float-right font-bold text-white">165%</span></li>
      </ul>
    </section>

    <!-- 서비스 패키지 -->
    <section class="metrics">
      <h2 class="text-white font-semibold mb-2">서비스 패키지</h2>
      <div id="accordion-container" class="space-y-3"></div>
    </section>

    <!-- 카트 & 신청 -->
    <footer>
      <div class="flex justify-between items-center mb-3">
        <span class="text-gray-400">총 합계 (VAT 별도)</span>
        <span id="total-price" class="text-xl font-bold text-white">0원</span>
      </div>
      <button id="submit-campaign-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-full disabled:bg-gray-700" disabled>무료 견적 신청하기</button>
    </footer>
  </div>

  <!-- Three.js Starfield -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    let scene, camera, renderer, stars;
    let starGeo, starMat;
    const STAR_COUNT = 20000;
    init(); animate();
    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 1, 3000);
      camera.position.z = 400;
      renderer = new THREE.WebGLRenderer({ alpha:true, antialias:true });
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.getElementById('three-container').appendChild(renderer.domElement);
      window.addEventListener('resize',()=>{camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight);});
      // 별 필드
      starGeo = new THREE.BufferGeometry();
      const pos = new Float32Array(STAR_COUNT*3);
      for(let i=0;i<STAR_COUNT;i++){pos[i*3]=(Math.random()-0.5)*2000;pos[i*3+1]=(Math.random()-0.5)*2000;pos[i*3+2]=(Math.random()-0.5)*2000;}      
      starGeo.setAttribute('position', new THREE.BufferAttribute(pos,3));
      starGeo.setDrawRange(0,0);
      const sprite = new THREE.TextureLoader().load('https://threejs.org/examples/textures/sprites/spark1.png');
      starMat = new THREE.PointsMaterial({ map:sprite, size:2, transparent:true, blending:THREE.AdditiveBlending, depthWrite:false, opacity:0.5 });
      stars = new THREE.Points(starGeo, starMat);
      scene.add(stars);
    }
    function animate() {
      // 예상 도달 값 연동
      const reach = parseInt(
        document.getElementById('total-reach').textContent.replace(/,/g,'')) || 0;
      // 감소된 민감도로 수치 확장 비율 재조정
      let ratio = Math.min(reach / 300000, 1);
      // 시작부터 10% 기본 별 표시 + 최대 100%까지 선형 증가
      const eff = 0.1 + ratio * 0.9;

      // 별 개수, 크기, 불투명도 업데이트
      starGeo.setDrawRange(0, Math.floor(STAR_COUNT * eff));
      starMat.opacity = 0.2 + 0.8 * ratio;
      starMat.size    = 1 + 9 * ratio;

      // 회전 애니메이션
      stars.rotation.y += 0.0007;
      stars.rotation.x += 0.0004;

      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    }
  </script>

  <!-- Campaign Builder Logic -->
  <script>
    document.addEventListener('DOMContentLoaded',()=>{
      const productsData = {
        '네이버 블로그': {
          name:'네이버 블로그', items:[
            {id:'blog-seed', name:'블로그(씨앗)', price:80000, reach:1250},
            {id:'blog-sprout', name:'블로그(새싹)', price:150000, reach:6000},
            {id:'blog-fruit', name:'블로그(열매)', price:300000, reach:15000}
          ]
        },
        '인스타그램': {
          name:'인스타그램', items:[
            {id:'insta-img', name:'이미지 광고', price:200000, reach:30000},
            {id:'insta-vid', name:'숏폼 광고', price:450000, reach:30000},
            {id:'insta-mix', name:'이미지+숏폼', price:1200000, reach:100000}
          ]
        },
        '페이스북': {
          name:'페이스북 광고', items:[
            {id:'fb-img', name:'이미지 광고', price:250000, reach:50000},
            {id:'fb-vid', name:'동영상 광고', price:600000, reach:120000}
          ]
        },
        '유튜브': {
          name:'유튜브 광고', items:[
            {id:'yt-skip', name:'스킵가능', price:800000, reach:150000},
            {id:'yt-noskip', name:'스킵불가', price:1000000, reach:120000}
          ]
        }
      };
      const cart = {};
      const totalReachEl = document.getElementById('total-reach');
      const acc = document.getElementById('accordion-container');
      const priceEl = document.getElementById('total-price');
      const btn = document.getElementById('submit-campaign-btn');
      function render(){
        let html='';
        for(const key in productsData){
          const ch = productsData[key];
          let itemsHtml='';
          ch.items.forEach(p=>{
            const q = cart[p.id]||0;
            itemsHtml += `
              <div class="flex justify-between items-center bg-gray-800 p-3 rounded-lg">
                <div>
                  <p class="font-semibold text-white">${p.name}</p>
                  <p class="text-xs text-gray-400">${p.price.toLocaleString()}원 / 명</p>
                </div>
                <div class="flex items-center space-x-2">
                  <button data-id="${p.id}" class="cart-quantity-change bg-gray-700 rounded w-6 h-6 text-white">−</button>
                  <span class="text-white font-bold">${q}</span>
                  <button data-id="${p.id}" class="cart-quantity-change bg-blue-600 rounded w-6 h-6 text-white">＋</button>
                </div>
              </div>`;
          });
          html += `
            <div class="accordion-item bg-gray-900 rounded-xl border border-gray-800 overflow-hidden">
              <button class="accordion-header w-full text-left p-4 flex justify-between items-center">
                <span class="font-bold text-white">${ch.name}</span>
                <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>
              <div class="accordion-content px-4 space-y-3">${itemsHtml}</div>
            </div>`;
        }
        acc.innerHTML = html;
        attach();
      }
      function attach(){
        document.querySelectorAll('.accordion-header').forEach(h=>h.addEventListener('click',()=>{const c=h.nextElementSibling,ic=h.querySelector('svg');document.querySelectorAll('.accordion-content.open').forEach(o=>{if(o!==c){o.classList.remove('open');o.previousElementSibling.querySelector('svg').classList.remove('rotate-180');}});c.classList.toggle('open');ic.classList.toggle('rotate-180');}));
        document.querySelectorAll('.cart-quantity-change').forEach(b=>b.addEventListener('click',e=>{e.stopPropagation();const id=b.dataset.id;if(b.textContent==='＋'&&!(cart[id]>=100))cart[id]=(cart[id]||0)+1;else if(cart[id]>0){cart[id]--;if(!cart[id])delete cart[id];}render();update();}));
      }
      let raf;
      function animateReach(end){const start=parseInt(totalReachEl.textContent.replace(/,/g,''))||0;if(start===end)return;const dur=800;let st;function step(ts){if(!st)st=ts;const p=Math.min((ts-st)/dur,1);totalReachEl.textContent=Math.floor(p*(end-start)+start).toLocaleString();if(p<1)raf=requestAnimationFrame(step);}cancelAnimationFrame(raf);raf=requestAnimationFrame(step);}
      function update(){let pr=0,r=0;Object.values(productsData).forEach(ch=>ch.items.forEach(p=>{if(cart[p.id]){pr+=p.price*cart[p.id];r+=p.reach*cart[p.id];}}));priceEl.textContent=`${pr.toLocaleString()}원`;btn.disabled=pr===0;animateReach(r);}      
      render(); update();
    });
  </script>
</body>
</html>
